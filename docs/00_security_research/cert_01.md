# 步骤
```
CERT->pcap 
\ ->咱们离线分析 \
\ ->产生审计日志和样本 \
\ ->沙箱和情报碰撞 \
\ ->上层业务系统进一步分析
```

## 1.  CERT->pcap

## 2. pcap -> 离线分析
> 平台上传的功能。
- 1. 注意接口安全性、存储安全性
- 2. 从远程设备中脱去

## 3. 离线分析-> 产生审计日志和样本

### 文件还原能力
- 1. 能对所有的tcp明文协议具备还原能力，例如ftp/http/nfs/smb/smtp/pop3等。【基本tcp】
- 2. 在沙箱中运行样本时，能对加密的tcp的流量进行payload提取和文件还原。(https/socks5成功)【正向代理技术】

### 协议识别
- 支持识别多种常见的协议
- DPI （包Packet检测）和 DFI （流Flow检测）技术结合能快速识别处通信的协议类型。
    - [DPI和DFI](https://www.cnblogs.com/xishaonian/p/7712951.html)

```
 DPI全称为 "Deep Packet Inspection"，称为"深度包检测"。DPI技术在分析包头的基础上，增加了对应用层的分析，是一种基于应用层的流量检测和控制技术，当IP数据包、,或UDP数据流经过基于DPI技术的带宽管理系统时，该系统通过深入读取IP包载荷的内容来对OSI7层协议中的应用层信息进行重组，从而得到整个应用程序的内容，然后按照系统定义的管理策略对流量进行整形操作。
```

## 4. 审计日志和样本 -> 沙箱和情报碰撞

通过上面的步骤，我们提取了
- 1. 识别并分离出各个协议类型的审计日志后。
    - 1. 基于netflow的五元组对ip进行威胁情报的碰撞
    - 2. 如果是 dns / tls-sni 能对提取的域名联合威胁情报进行分析; 对域名的通信流量进行聚类
    - 3. 分离到对应的协议类型的日志后，调取对应的应用协议分析策略或者规则。
        - 1. http有web检测分析功能，调用payload知识库对请求头和请求体进行分析。
        - 2. kuberos 协议提取出对应的payload和预先存储的策略碰撞即可。

- 2. 提取文件以及文件日志后
    - 1. 如果文件的hash已经在威胁情报中，那么就不进行分析
    - 2. 如果hash不在威胁情报中，放入沙箱跑样本。如果沙箱对样本的评分大于阈值，讲跑出来的ioc情报加入到威胁情报中。

## 5.  沙箱和情报碰撞 -> 进一步分析

## 沙箱技术补充
- 1.对文件的沙箱分析能支持多种文件类型。（exe,pdf,doc,excel,html,js,jsp等）

- 2.能模拟大多数主流系统和软件的沙箱环境 （windows / office / pdf阅读区等）

- 3.全方位监控
  > 从漏洞触发到漏洞利用到payload执行，对各个环节进行了监控，能识别已知和位置的漏洞。

- 4. APT 威胁的反躲避能力
> 针对APT威胁的各种躲避技术，威胁的各种躲避技术，提供基于虚拟机检测技术（判断是否运行在虚拟机环境中）的反躲避手段、基于用户交互的反躲避手段。

- 5. 样本去壳能力和病毒家族识别
> 能对多种常见的壳进行去壳后进行静态识别后进行分析。能快速定位出样本的威胁类型以及病毒家族的类型。

- 性能【x】
    - 实时的处置和响应能力